好同学们
在刚刚我们已经学习了镜像的一个内部结构了
那这节课我们就来学习一下如何自定义镜像
那自定义镜像一定会用到docker file
dog file啊
是一个文本文件
里边有很多很多的指令
这些指令就是来描述你这个镜像
内部是如何构建的
它就可以当做是一个镜像构建的说明书
将来我们的docker啊
会按照这里边的指令去构建好我们的镜像
每一个指令就会形成一层的layer啊
那这里我列出了一些dog file的常见指令
我们用的最多的就这些了
因为我们构建java项目吧
没有那么复杂
那比如说第一个指令呢是from
它呢是指定一个基础镜像
那一般是操作系统
比方说这里from渗透六
那也就是基于渗透六呢去完成构建
或者呢你也可以基于这个bun to
对吧啊
16点点四之类的也都可以
下边呢e n v它是一个缩写啊
environment就是环境变量
环境变量呢一般是一个键值对
一旦配好了以后
在后续的过程中
大家都可以使用这个环境变量里面配好的东西
比方说我们可以配好一个目录
那在后续使用过程中
大家都可以用这个目录啊
然后再往下呢copy啊
也就是我们的复制啊
那我们本地呢有一个java的一个项目包
那将来我们要call到镜像里边去
就可以用这个cbd命令了
然后run呢是运行的意思
那它特指是执行linux的shell命令
一般呢是安装命令啊
比方说我这里有一个什么依赖
需要去做安装或者解压
我都可以利用run后面跟上对应的shell命令就行了
再往下就是expose
它呢是指暴露端口
当然这个可不是真正暴露端口啊
大家还记得我们以前在创建容器时
要加杠p参数吧
那个才是指定宿主机和容器的映射端口
那么容器将来暴露谁这儿呢
只是指定说诶我容器内我监听的是什么端口
他是给那个镜像的使用者看的
镜像使用者一看说哦
原来你这里边用的是8080啊
那我杠p参数
冒号后面那一部分是不是就必须写8080了
所以起这么个作用啊
那杠屁是不能省的
这个加或不加
那么其实都可以啊
加了的话
经常使用者一看就很明白了吗
嗯再往下呢
enterpoint就是启动命令了
那我们讲一个镜像一定要有一个启动的脚本吧
那作为一个java项目
启动脚本就非常的简单
就是java杠架什么什么点价就可以了行了
那这些呢就是我们到file中比较常见的命令了
如果大家想要更详细的去了解其他的一些命令
可以参考一下这个网站啊
这上面都有啊
好
那接下来呢我们就基于一个案例来看一看
如何利用dog file构建镜像
案例是这样子的
让我们基于one two的一个镜像来构建新景象
并且运行java项目
那它的一个步骤已经详细的给我们列出来了
等一会儿呢我们照着一步一步做就行了啊
我们先来简单看一下
这里呢让我们先建一个新的文件夹
叫做doctor demo
这个文件夹显然是用来放我们构建镜像
所需要的各种材料的啊
那你可以看到呢
这里首先要拷贝的是一个docker demo
点ja一个java项目到这个目录
然后再拷贝一下gdp到这个目录
最后是docker file
那也就是说他是那个构建的说明书吧
现在我们先带大家看一下这个说明书啊
看他到底要干什么
我们来打开课前资料
找到file
我们把它打开
那同时你应该能够看到在这还有这个java工程
还有这个gdp吗
因为我们构建整个项目是基于这个one to
这个镜像来做的
那这个镜像是干干净净的一个基础镜像
上面啥都没有
那我们知道java项目要运行必须依赖于jdk吧
所以在这个构建过程中
它主要就是在安装jdk啊
所以你看from bto 16点点四
就是构建一个基础镜像
而后呢这就配了一下环境变量
其实就是gdp的一个安装目录嘛
安装到了usr local下面
接下来呢就是把刚才那两个包做了个拷贝
拷贝到哪里去呢
我们的gdp呢就考到了前边这个java d i r
他所在的那个文件夹了
然后呢我们的java项目考到了tm p目录下
重命名为app点加
接下来开始安装jdk
安装jdk呢通过了一个rap
然后先cd到那个安装目录去
好你可以看到这个变量是不是重复的在使用啊
这就是定义变量的好处吗
那好那我cd到这个目录下来以后
我就开始解压缩
然后重命名
同学们
这是不是安装jdk的必备步骤啊
最后是不是该配环境变量了
把这个java目录配进去吧
看java home
再看配这个pass
唉那么这样整个gdp安装好了
那最后呢暴露一下端口
然后暴露一个这个什么呀
entry point enterpoint是不是启动命令啊
那启动的方式就是java钢架什么什么点价呗
所以你可以看到整个这个dog file其实并不复杂嘛
就是把jdk安好
然后呢给这个启动命令写好就行了
那docker file
它会依赖于
或者说他需要刚才看到的这俩文件吗
下边呢我们就把这三个东西一并给他
拷到我们的虚拟机上
我们打开shell控制台
先在某个目录下创建一个这个doctor demo吧
比如说我们到tm p嗯
make给dr docker demo好
我们看一眼好文件夹
现在这里边是空的吧
那我们来做个上传
我们把它往上拉一点
打开代码
在这空的我们开始上传
找到课件资料
然后我们采用拖拽方式啊
这三个东西给拖起来呃
jdk他还有架包走
你这上传速度还是挺快的啊
成功了
同学们来再l l一下
看三个是不是都来了
下边就可以去利用docker file构建镜像了吧
这个命令也很简单啊
叫做docker的build就是构建的意思
然后后边跟上一个杠t杠t呢其实全称叫tag
我们知道一个镜像要有名称
名称由两部分组成
第一部分叫repository
第二部分就是这个tag
那repository就是名字呗
我们可以随便起啊
比如说就叫ja web
这就是镜像名称了吗
然后tag是版本也可以随便起
比如一点
那最后这个命令到这没有结束啊
一定要加上一个点
而且是空格之后加了个点
看到吗
这有个空格
这个点代表什么呢
代表的是docker fell所在的目录
那现在我来了个docker build gt
就是要构建
构建的时候
你得告诉他都要放在哪里吧
我就在dfa所在目录
所以我是不是用点来表示
切记啊
要用点来表示啊
然后呢我们这里回车
你可以看到它在逐步执行我们的指令吧
每执行一个指令就会有一次的层出现啊
而且大家来看这个拷贝的动作
这个拷贝的这个地方是不是从当前目录去call啊
啊
call到指定位置嘛
那我们刚好的命令就是在当前目录来执行的
所以他考从当前目录考是不是很合适
好整个镜像构建完毕
我们通过docker哪个命令来查看呀
emies吧
走看一看是不是构建好了啊
没问题
27秒前刚刚构建的还在热乎着
那我把它跑起来
怎么跑到
看什么run吧
来个杠杠name
随便起个名字就叫web
再来个杠p端口映射
我们这里是8090
刚才那个door file里也有
对不对
所以用8090
然后杠d后台运行嘛
最后是镜像名
叫做java web一点零好
那这样我们回车
完成docker ps
看一看是不是成功启动了
三秒钟以前8090
那我们去页面访问一下吧
来我们打开浏览器
我们在这呢输入个地址
1921681061008090杠
我这个项目的地址是hello
count啊
走看是不是访问成功了
这就说明我们这个项目呀已经成功的构建镜像
并且部署到docker容器了行了
那我们这个功能就完成了
我们回到ppt
刚才我们是基于这个buto的镜像来构建的
那这个镜像的构建我们也发现了还是挺麻烦的
我们打开文档看一眼是不是要经过很多步啊
而在这么多步骤当中
其实真正是来构建java项目的
就是这行拷贝
因为java项目不需要安装吗
拷过来是不是就能用
我把它放到最下边
也就是说上面的动作其实都是在安装jdk
那大家想想看啊
如果说我现在又有一个微服务需要构建了
将来咱们有成千上百的微服务
每个微服务在做构建时都要执行着完整的流程
同学们
你觉得麻烦吗
是不是挺麻烦的
我们的镜像既然已经做了分层
而这里的前n层大家看
不管是这个java项目还是再换一个java项目
前n层会不会变
不会吧
那我为什么不把这前n层提前构建好
做一个镜像先放到那里以后
我都在这个基础上再去构建
是不是就方便多了
这就是分层的好处吧
那同学们来看
事实上有人已经帮我们做了这件事了
谁呢
有一个名为java 8 open的这样一个镜像
这个open镜像啊
它是一个体积非常小的一个gdp的一个镜像啊
那也就是说
这个镜像已经帮我们把前n部是不是全做完了
那如果说我在构建镜像时
我是以它为基础的话
同学们
我这些动作是不是都可以省掉了
能理解吗
那也就是说我怎么做
我是不是可以把这个中间这段全删掉
不要了
我只需要基于它来构建
是不是就行了
把它改成java冒号八杠open
就这个啊
改成这个了以后呢
我们中间是不是省了超级多了
那以后你再构建其他为辅
是不是都这么难做呀
太爽了啊
来保存一下
我们试一试啊
同学们怎么试呢
我们打开是要控制台
我们利用课前资料
刚刚我们改的那个给它干嘛呀
覆盖一下吧
覆盖成功了
改成了
我们来看一眼吧
cat一下docker file
哎是不是改成叫八open了
现在我来再次构建
我们再来docker build一下杠
什么来着t对不对
然后跟那个名字
这次来个java web冒号二点
然后来个点回车
同学们看这次是从这个java open来构建的了吧
而且大家看这个步骤啊
只剩下几步了
是不是只剩四步了
先拉取这个jva 8的这个up镜像啊
这以前没拉过
它就会比较慢好
总共只需要四步就能完成了
第一步from
第二部拷贝
第三部暴露
然后暴露这个入口就行了
是不是比之前的这种方式要方便多了好了
那到这儿呢
我们镜像构建的所有案例就演示完了
我们回到ppt啊
最后我们做个总结
docker fell是干什么的呀
它的本质其实很简单
就是个文件
只不过里边有很多的指令
来构建这个镜像描述的过程
而到file的第一行一定是from基础镜像
这个技术影像可以是一个从零开始的操作系统
那这样呢你去做的时候就比较麻烦
还可以是什么呀
还可以是别人做好的景象
那这样我们可以共享前面几层
我是不是直接做后边呀
这样就会很方便了行了
那我们这节课内容就到这里
